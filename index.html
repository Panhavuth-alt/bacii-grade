<!DOCTYPE html>
<html lang="km">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á–á·á“áŸ’á‘á» ááŸ’á“á¶á€áŸ‹á‘á¸áŸ§-áŸ©</title>

<!-- â”€â”€ PWA: iOS Safari â”€â”€ -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BacII Grade">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0e2044">
<meta name="description" content="Cambodia Grade 7-9 School Grade Management System">

<!-- â”€â”€ Apple Touch Icons â”€â”€ -->
<link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,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">
<link rel="apple-touch-icon" sizes="152x152" href="data:image/png;base64,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">
<link rel="apple-touch-icon" sizes="120x120" href="data:image/png;base64,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">

<!-- â”€â”€ PWA Manifest (inline) â”€â”€ -->
<link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22%E1%9E%94%E1%9F%92%E1%9E%9A%E1%9E%96%E1%9F%91%E1%9E%93%E1%9F%92%E1%9E%92%E1%9E%82%E1%9F%92%E1%9E%9A%E1%9E%94%E1%9F%CB%E1%9E%82%E1%9E%9D%E1%9E%94%E1%9F%92%E1%9E%9A%E1%9E%96%E1%9F%B9%E1%9E%93%E1%9F%92%E1%9E%8F%E1%9E%BB%22%2C%22short_name%22%3A%22BacII+Grade%22%2C%22start_url%22%3A%22.%2F%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%230e2044%22%2C%22theme_color%22%3A%22%230e2044%22%7D">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Khmer:wght@300;400;500;600;700;800&family=Noto+Serif:ital,wght@0,700;0,900;1,700&family=DM+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --navy:#0e2044;--navy2:#162d5e;--navy3:#1e3a7a;
  --red:#c0272d;--red2:#e53935;
  --gold:#c9922b;--gold2:#e8b84b;--gold-pale:#fdf0d5;
  --cream:#fdf6e8;--cream2:#f5e9ce;--cream3:#ede0b8;
  --green:#1a6b42;--green2:#d4edda;
  --text:#1a1a1a;--muted:#717070;--border:#ddd5b5;
  --white:#ffffff;
  --pass-bg:#d4edda;--pass-fg:#155724;
  --fail-bg:#f8d7da;--fail-fg:#721c24;
  --warn-bg:#fff3cd;--warn-fg:#856404;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;overflow:hidden;-webkit-text-size-adjust:100%;}
body{
  font-family:'Noto Sans Khmer',sans-serif;
  background:var(--cream);
  display:flex;flex-direction:column;
  max-width:500px;margin:0 auto;
  position:relative;
  box-shadow:0 0 60px rgba(14,32,68,0.15);
  /* iOS safe area for notch & home indicator */
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
  min-height: 100vh;
  min-height: -webkit-fill-available;
}
html {
  height: -webkit-fill-available;
}

/* â”€â”€ TOPBAR â”€â”€ */
.topbar{
  background:linear-gradient(135deg,var(--navy) 60%,var(--navy3));
  padding:13px 16px 11px;
  display:flex;align-items:center;justify-content:space-between;
  flex-shrink:0;z-index:20;
  border-bottom:3px solid var(--gold);
}
.tb-left{display:flex;align-items:center;gap:10px;}
.tb-emblem{
  width:38px;height:38px;border-radius:50%;
  background:var(--gold);
  display:flex;align-items:center;justify-content:center;
  font-size:18px;flex-shrink:0;
  box-shadow:0 2px 8px rgba(0,0,0,0.3);
}
.tb-titles{}
.tb-title{font-family:'Noto Serif',serif;font-size:14px;font-weight:900;color:#fff;line-height:1.2;}
.tb-sub{font-size:10px;color:rgba(255,255,255,0.5);margin-top:1px;}
.grade-switcher{display:flex;gap:4px;}
.grade-pill{
  padding:5px 10px;border-radius:99px;
  font-size:12px;font-weight:700;
  border:1.5px solid rgba(255,255,255,0.25);
  background:transparent;color:rgba(255,255,255,0.6);
  cursor:pointer;font-family:inherit;
  transition:all 0.2s;
}
.grade-pill.active{background:var(--gold);color:var(--navy);border-color:var(--gold);}

/* â”€â”€ SCROLLABLE PAGE â”€â”€ */
.page{flex:1;overflow-y:auto;overflow-x:hidden;padding:14px 14px 72px;display:none;}
.page.active{display:block;}

/* â”€â”€ BOTTOM TABS â”€â”€ */
.bottom-nav{
  height:60px;background:var(--white);
  border-top:1.5px solid var(--border);
  display:flex;flex-shrink:0;z-index:20;
  position:relative;
}
.nav-tab{
  flex:1;display:flex;flex-direction:column;
  align-items:center;justify-content:center;gap:2px;
  border:none;background:transparent;cursor:pointer;
  font-family:inherit;color:var(--muted);
  font-size:9px;font-weight:600;
  text-transform:uppercase;letter-spacing:0.4px;
  transition:color 0.2s;
  -webkit-tap-highlight-color:transparent;
}
.nav-tab svg{width:20px;height:20px;stroke:currentColor;fill:none;stroke-width:1.8;transition:stroke 0.2s;}
.nav-tab.active{color:var(--navy);}
.nav-tab.active svg{stroke:var(--navy);}
.nav-ind{
  position:absolute;top:0;height:2.5px;background:var(--gold);
  transition:left 0.3s cubic-bezier(0.34,1.56,0.64,1);
  border-radius:0 0 3px 3px;
  width:25%;
}

/* â”€â”€ SHARED STYLES â”€â”€ */
.sec-title{font-family:'Noto Serif',serif;font-size:17px;font-weight:900;color:var(--navy);margin-bottom:3px;}
.sec-sub{font-size:11px;color:var(--muted);margin-bottom:14px;}
.card{background:var(--white);border:1.5px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px;}
.card-title{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.7px;margin-bottom:10px;}
.lbl{display:block;font-size:11px;font-weight:700;color:var(--muted);margin-bottom:5px;text-transform:uppercase;letter-spacing:0.5px;}
.inp{
  width:100%;padding:10px 12px;
  border:1.5px solid var(--border);border-radius:10px;
  font-family:inherit;font-size:13px;color:var(--text);
  background:var(--cream);outline:none;
  transition:border-color 0.2s,box-shadow 0.2s;
}
.inp:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,146,43,0.15);background:#fff;}
.btn-primary{
  width:100%;padding:13px;border:none;border-radius:11px;
  background:var(--navy);color:#fff;
  font-family:inherit;font-size:13px;font-weight:700;
  cursor:pointer;transition:background 0.2s,transform 0.15s;
  box-shadow:0 3px 14px rgba(14,32,68,0.2);
}
.btn-primary:hover{background:var(--navy2);}
.btn-primary:active{transform:scale(0.98);}
.btn-gold{background:var(--gold);color:var(--navy);}
.btn-gold:hover{background:var(--gold2);}
.btn-red{background:var(--red);color:#fff;}
.btn-tg{background:#0088cc;color:#fff;}
.divider{height:1px;background:var(--border);margin:12px 0;}

/* â”€â”€ SETUP TAB â”€â”€ */
.student-add-row{display:flex;gap:8px;margin-top:10px;}
.btn-add-s{
  background:var(--navy);color:#fff;border:none;
  border-radius:10px;padding:10px 14px;
  font-family:inherit;font-size:12px;font-weight:700;
  cursor:pointer;white-space:nowrap;flex-shrink:0;
  transition:background 0.2s,transform 0.15s;
}
.btn-add-s:active{transform:scale(0.97);}
.student-list{display:flex;flex-direction:column;gap:6px;margin-top:10px;}
.student-item{
  display:flex;align-items:center;gap:8px;
  background:var(--cream);border:1.5px solid var(--border);
  border-radius:10px;padding:9px 12px;
  animation:slideIn 0.2s ease;
}
@keyframes slideIn{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}
.si-num{
  width:24px;height:24px;border-radius:50%;
  background:var(--cream2);color:var(--muted);
  font-size:10px;font-weight:700;font-family:'DM Mono',monospace;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.si-name{flex:1;font-size:13px;font-weight:600;color:var(--text);}
.btn-del{
  width:26px;height:26px;border-radius:7px;border:none;
  background:transparent;cursor:pointer;color:var(--muted);font-size:14px;
  display:flex;align-items:center;justify-content:center;
  transition:background 0.15s,color 0.15s;
}
.btn-del:hover{background:var(--fail-bg);color:var(--red);}
.empty-hint{text-align:center;padding:24px 12px;color:var(--muted);font-size:12px;}
.count-badge{
  display:inline-block;background:var(--navy);color:#fff;
  font-size:10px;font-weight:700;padding:2px 8px;border-radius:99px;margin-left:6px;
}

/* â”€â”€ GRADES TAB â”€â”€ */
.student-select{margin-bottom:12px;}
.sem-toggle{display:flex;gap:6px;margin-bottom:10px;}
.sem-btn{
  flex:1;padding:9px;text-align:center;border-radius:10px;
  border:1.5px solid var(--border);
  font-family:inherit;font-size:12px;font-weight:700;
  background:var(--cream);color:var(--muted);cursor:pointer;
  transition:all 0.2s;
}
.sem-btn.active{background:var(--navy);color:#fff;border-color:var(--navy);}
.month-tabs{display:flex;gap:4px;margin-bottom:12px;overflow-x:auto;padding-bottom:2px;}
.month-tabs::-webkit-scrollbar{display:none;}
.month-btn{
  padding:6px 12px;border-radius:8px;border:1.5px solid var(--border);
  font-family:inherit;font-size:11px;font-weight:600;
  background:var(--cream);color:var(--muted);cursor:pointer;
  white-space:nowrap;flex-shrink:0;
  transition:all 0.2s;
}
.month-btn.active{background:var(--gold);color:var(--navy);border-color:var(--gold);}
.month-btn.has-data{border-color:var(--navy2);color:var(--navy);}

/* Subject score table */
.score-table{width:100%;border-collapse:collapse;}
.score-table th{
  font-size:10px;font-weight:700;color:var(--muted);
  text-transform:uppercase;letter-spacing:0.5px;
  padding:6px 8px;border-bottom:1.5px solid var(--border);
  text-align:left;
}
.score-table th:last-child{text-align:right;}
.score-table td{padding:6px 8px;border-bottom:1px solid var(--cream2);}
.score-table tr:last-child td{border-bottom:none;}
.sub-name-cell{font-size:12px;color:var(--text);font-weight:600;}
.sub-coef-cell{font-size:10px;color:var(--gold);font-weight:700;font-family:'DM Mono',monospace;}
.score-inp{
  width:70px;padding:7px 8px;text-align:center;
  border:1.5px solid var(--border);border-radius:8px;
  font-family:'DM Mono',monospace;font-size:13px;font-weight:600;
  color:var(--text);background:var(--cream);outline:none;
  transition:border-color 0.2s,box-shadow 0.2s;
  -moz-appearance:textfield;display:block;margin-left:auto;
}
.score-inp::-webkit-outer-spin-button,.score-inp::-webkit-inner-spin-button{-webkit-appearance:none;}
.score-inp:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,146,43,0.15);background:#fff;}
.score-inp.err{border-color:var(--red);}
.save-month-btn{
  width:100%;margin-top:12px;padding:12px;border:none;border-radius:11px;
  background:var(--navy);color:#fff;font-family:inherit;font-size:13px;font-weight:700;
  cursor:pointer;transition:background 0.2s,transform 0.15s;
}
.save-month-btn:active{transform:scale(0.98);}

/* Live averages panel */
.avg-panel{background:var(--navy);border-radius:12px;padding:12px 14px;margin-top:10px;}
.avg-panel-title{font-size:10px;font-weight:700;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:0.6px;margin-bottom:8px;}
.avg-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;}
.avg-box{background:rgba(255,255,255,0.07);border-radius:8px;padding:8px;text-align:center;}
.avg-val{font-family:'DM Mono',monospace;font-size:17px;font-weight:600;color:var(--gold2);}
.avg-lbl{font-size:9px;color:rgba(255,255,255,0.4);margin-top:2px;text-transform:uppercase;letter-spacing:0.4px;}

/* â”€â”€ RANKINGS TAB â”€â”€ */
.class-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;}
.cstat{
  background:var(--white);border:1.5px solid var(--border);
  border-radius:12px;padding:12px;text-align:center;
}
.cstat-val{font-family:'Noto Serif',serif;font-size:22px;font-weight:900;color:var(--navy);}
.cstat-lbl{font-size:10px;color:var(--muted);margin-top:1px;text-transform:uppercase;letter-spacing:0.5px;}
.rank-list{display:flex;flex-direction:column;gap:7px;}
.rank-card{
  display:flex;align-items:center;gap:10px;
  background:var(--white);border:1.5px solid var(--border);
  border-radius:12px;padding:11px 13px;
  transition:border-color 0.2s;animation:slideIn 0.25s ease;
}
.rank-card:hover{border-color:var(--gold);}
.medal{
  width:34px;height:34px;border-radius:50%;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  font-family:'DM Mono',monospace;font-size:13px;font-weight:700;
}
.m1{background:#FFD700;color:#5a3e00;}
.m2{background:#C0C0C0;color:#333;}
.m3{background:#CD7F32;color:#fff;}
.mn{background:var(--cream2);color:var(--muted);font-size:11px;}
.rank-info{flex:1;min-width:0;}
.rank-name{font-size:13px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rank-detail{font-size:10px;color:var(--muted);margin-top:2px;}
.rank-right{display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0;}
.rank-avg{font-family:'DM Mono',monospace;font-size:17px;font-weight:600;color:var(--navy);}
.rank-badge,.status-badge{font-size:10px;font-weight:700;padding:2px 8px;border-radius:99px;}
.badge-pass{background:var(--pass-bg);color:var(--pass-fg);}
.badge-fail{background:var(--fail-bg);color:var(--fail-fg);}
.badge-warn{background:var(--warn-bg);color:var(--warn-fg);}
.tg-mini{
  width:26px;height:26px;border-radius:7px;
  background:#0088cc;color:#fff;border:none;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:13px;flex-shrink:0;transition:opacity 0.2s,transform 0.15s;
}
.tg-mini:active{transform:scale(0.9);}

/* â”€â”€ REPORT TAB â”€â”€ */
.report-header{
  background:var(--navy);border-radius:14px;padding:16px;margin-bottom:12px;
  text-align:center;position:relative;overflow:hidden;
}
.report-header::before{
  content:'';position:absolute;top:-20px;right:-20px;
  width:80px;height:80px;border-radius:50%;background:rgba(201,146,43,0.15);
}
.report-seal{font-size:32px;margin-bottom:6px;}
.report-school{font-size:10px;color:rgba(255,255,255,0.5);letter-spacing:0.5px;}
.report-student{font-family:'Noto Serif',serif;font-size:20px;font-weight:900;color:#fff;margin:4px 0;}
.report-meta{font-size:11px;color:rgba(255,255,255,0.6);}
.report-period-select{display:flex;gap:6px;margin-bottom:12px;overflow-x:auto;}
.report-period-select::-webkit-scrollbar{display:none;}
.period-btn{
  padding:7px 12px;border-radius:8px;border:1.5px solid var(--border);
  font-family:inherit;font-size:11px;font-weight:700;
  background:var(--cream);color:var(--muted);cursor:pointer;
  white-space:nowrap;flex-shrink:0;transition:all 0.2s;
}
.period-btn.active{background:var(--navy);color:#fff;border-color:var(--navy);}

/* Subject report rows */
.sub-report-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:8px 0;border-bottom:1px solid var(--cream2);gap:8px;
}
.sub-report-row:last-child{border-bottom:none;}
.sr-name{font-size:12px;font-weight:600;color:var(--text);flex:1;}
.sr-coef{font-size:10px;color:var(--gold);font-weight:700;margin-right:4px;}
.sr-scores{display:flex;gap:3px;align-items:center;flex-wrap:wrap;justify-content:flex-end;}
.score-chip{
  font-family:'DM Mono',monospace;font-size:10px;font-weight:500;
  padding:2px 6px;border-radius:5px;background:var(--cream2);color:var(--text);
  border:1px solid var(--cream3);
}
.score-chip.empty{color:var(--muted);}
.score-chip.avg{background:var(--navy);color:var(--gold2);font-weight:700;}
.score-chip.yearly{background:var(--gold);color:var(--navy);font-weight:700;}

/* Summary card */
.summary-card{
  background:var(--navy);border-radius:14px;padding:16px;margin-top:12px;
}
.summary-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;}
.sum-box{background:rgba(255,255,255,0.07);border-radius:10px;padding:10px;text-align:center;}
.sum-val{font-family:'Noto Serif',serif;font-size:24px;font-weight:900;color:var(--gold2);}
.sum-lbl{font-size:9px;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:0.5px;margin-top:2px;}
.sum-status{
  text-align:center;padding:10px;border-radius:10px;
  font-size:14px;font-weight:700;margin-bottom:12px;
}
.action-row{display:flex;gap:8px;}
.action-btn{
  flex:1;padding:12px 8px;border:none;border-radius:10px;
  font-family:inherit;font-size:12px;font-weight:700;
  cursor:pointer;transition:opacity 0.2s,transform 0.15s;
}
.action-btn:active{transform:scale(0.97);}

/* Utility */
.tag{display:inline-block;font-size:10px;font-weight:700;padding:2px 8px;border-radius:99px;}
.tag-gold{background:var(--gold-pale);color:var(--gold);}
.tag-navy{background:var(--navy);color:#fff;}
.text-muted{color:var(--muted);font-size:12px;}
.no-student{text-align:center;padding:40px 16px;color:var(--muted);font-size:13px;}
.no-student .icon{font-size:40px;margin-bottom:10px;}
select.inp{appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px;}
.progress-bar-wrap{height:5px;background:var(--cream2);border-radius:99px;margin-top:5px;overflow:hidden;}
.progress-bar{height:100%;border-radius:99px;transition:width 0.5s ease;}

/* â”€â”€ BULK GRID â”€â”€ */
.bulk-row{
  display:flex;align-items:center;gap:10px;
  padding:7px 0;border-bottom:1px solid var(--cream2);
}
.bulk-row:last-child{border-bottom:none;}
.bulk-num{
  width:22px;height:22px;border-radius:50%;
  background:var(--cream2);color:var(--muted);
  font-size:10px;font-weight:700;font-family:'DM Mono',monospace;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.bulk-name{flex:1;font-size:12px;font-weight:600;color:var(--text);min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.bulk-prev{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);flex-shrink:0;width:28px;text-align:right;}
.bulk-inp{
  width:64px;padding:7px 6px;text-align:center;
  border:1.5px solid var(--border);border-radius:8px;
  font-family:'DM Mono',monospace;font-size:13px;font-weight:600;
  color:var(--text);background:var(--cream);outline:none;
  transition:border-color 0.2s,box-shadow 0.2s;
  -moz-appearance:textfield;flex-shrink:0;
}
.bulk-inp::-webkit-outer-spin-button,.bulk-inp::-webkit-inner-spin-button{-webkit-appearance:none;}
.bulk-inp:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,146,43,0.15);background:#fff;}
.bulk-inp.err{border-color:var(--red);}
.bulk-avg-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;font-size:12px;}
.bulk-avg-name{color:rgba(255,255,255,0.7);}
.bulk-avg-val{font-family:'DM Mono',monospace;font-weight:700;color:var(--gold2);}
/* Save indicator */
.save-pulse{
  display:inline-block;width:8px;height:8px;border-radius:50%;
  background:#4ade80;margin-right:6px;
  animation:pulse 1.5s ease infinite;
}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.4;transform:scale(0.8)}}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="tb-left">
    <div class="tb-emblem">ğŸ«</div>
    <div class="tb-titles">
      <div class="tb-title">á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á–á·á“áŸ’á‘á»</div>
      <div class="tb-sub" id="tbSub">Grade Management System Â· MoEYS</div>
    </div>
  </div>
  <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;">
    <div class="grade-switcher">
      <button class="grade-pill active" onclick="setGrade(7)">G7</button>
      <button class="grade-pill" onclick="setGrade(8)">G8</button>
      <button class="grade-pill" onclick="setGrade(9)">G9</button>
    </div>
    <div id="saveStatus" style="font-size:9px;color:rgba(255,255,255,0.35);display:flex;align-items:center;gap:3px;">
      <span class="save-pulse"></span>auto-save on
    </div>
  </div>
</div>

<!-- â•â• TAB 1: SETUP â•â• -->
<div class="page active" id="page-setup">
  <div class="sec-title">ášáŸ€á”á…áŸ†ááŸ’á“á¶á€áŸ‹</div>
  <div class="sec-sub">Class Setup Â· Enter school & student information</div>

  <div class="card">
    <div class="card-title">á–áŸááŸŒá˜á¶á“áŸá¶á›á¶ Â· School Info</div>
    <label class="lbl">áˆáŸ’á˜áŸ„áŸ‡áŸá¶á›á¶ Â· School Name</label>
    <input class="inp" id="schoolName" type="text" placeholder="á§. á¢á“á»áœá·á‘áŸ’á™á¶á›áŸá™á–áŸ’ášáŸ‡áŸáŸŠá¸áŸá»áœááŸ’áá·">
    <div style="height:10px"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <div>
        <label class="lbl">ááŸ’á“á¶á€áŸ‹ Â· Class</label>
        <input class="inp" id="className" type="text" placeholder="á§. á€, á, áŸ¢á€">
      </div>
      <div>
        <label class="lbl">á†áŸ’á“á¶áŸ†áŸá·á€áŸ’áŸá¶ Â· Year</label>
        <input class="inp" id="schoolYear" type="text" placeholder="2024-2025">
      </div>
    </div>
    <div style="height:10px"></div>
    <label class="lbl">á‚áŸ’ášá¼ Â· Teacher Name</label>
    <input class="inp" id="teacherName" type="text" placeholder="á§. á›áŸ„á€á‚áŸ’ášá¼ á…á¶á“áŸ‹ áŠá¶ášáŸ‰á¶">
    <div style="height:10px"></div>
    <button class="btn-primary" onclick="saveSetup()">ğŸ’¾ ášá€áŸ’áŸá¶á‘á»á€á–áŸááŸŒá˜á¶á“ Â· Save Info</button>
  </div>

  <div class="card">
    <div class="card-title">
      á”á‰áŸ’á‡á¸áŸá·áŸáŸ’áŸ Â· Student List
      <span class="count-badge" id="studentCount">0</span>
    </div>
    <label class="lbl">á”á“áŸ’ááŸ‚á˜áŸá·áŸáŸ’áŸ Â· Add Student</label>
    <div class="student-add-row">
      <input class="inp" id="newStudentName" type="text" placeholder="áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ / Student name" onkeydown="if(event.key==='Enter')addStudent()">
      <button class="btn-add-s" onclick="addStudent()">+ á”á“áŸ’ááŸ‚á˜</button>
    </div>
    <div class="student-list" id="studentList">
      <div class="empty-hint">
        <div>ğŸ“‹</div>
        <div>á˜á·á“á‘á¶á“áŸ‹á˜á¶á“áŸá·áŸáŸ’áŸ Â· No students yet</div>
      </div>
    </div>
  </div>

  <!-- Subject Reference -->
  <div class="card">
    <div class="card-title">áœá·á‰áŸ’á‰á¶áŸá¶ & á˜áŸ‰áŸ‚ááŸ’áš Â· Subjects & Coefficients</div>
    <div id="subjectRef"></div>
  </div>

  <!-- Data Management -->
  <div class="card" style="border-color:var(--red);background:#fff8f8;">
    <div class="card-title" style="color:var(--red);">âš  á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á‘á·á“áŸ’á“á“áŸá™ Â· Data Management</div>
    <div style="font-size:11px;color:var(--muted);margin-bottom:10px;line-height:1.6;">
      á‘á·á“áŸ’á“á“áŸá™ášá€áŸ’áŸá¶á‘á»á€áŠáŸ„á™áŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá·á€áŸ’á“á»á„ browser á“áŸáŸ‡áŸ”<br>
      <em>Data is auto-saved in this browser. Clearing will delete everything.</em>
    </div>
    <div style="display:flex;gap:8px;">
      <button class="btn-primary" style="background:var(--green);font-size:12px;padding:10px;" onclick="exportData()">ğŸ“¤ Export JSON</button>
      <button class="btn-primary" style="background:var(--red);font-size:12px;padding:10px;" onclick="clearAllData()">ğŸ—‘ Clear All</button>
    </div>
  </div>
</div>

<!-- â•â• TAB 2: GRADES â•â• -->
<div class="page" id="page-grades">
  <div class="sec-title">á”á‰áŸ’á…á¼á›á–á·á“áŸ’á‘á»</div>
  <div class="sec-sub">Enter monthly scores for each subject Â· /50</div>

  <div id="gradesNoStudents" class="no-student" style="display:none;">
    <div class="icon">ğŸ‘¥</div>
    <div>áŸá¼á˜á”á“áŸ’ááŸ‚á˜áŸá·áŸáŸ’áŸá‡á¶á˜á»á“<br><span style="font-size:11px">Please add students in Setup first</span></div>
  </div>

  <div id="gradesContent">
    <!-- Mode Toggle -->
    <div class="sem-toggle" style="margin-bottom:12px;">
      <button class="sem-btn active" id="modeSingle" onclick="setGradeMode('single')">ğŸ‘¤ áŸá·áŸáŸ’áŸá˜áŸ’á“á¶á€áŸ‹</button>
      <button class="sem-btn" id="modeBulk" onclick="setGradeMode('bulk')">ğŸ‘¥ á‘á¶áŸ†á„ááŸ’á“á¶á€áŸ‹</button>
    </div>

    <!-- â”€â”€ SINGLE STUDENT MODE â”€â”€ -->
    <div id="singleModePanel">
    <div class="card" style="padding:10px 12px;">
      <label class="lbl">á‡áŸ’ášá¾áŸáŸá·áŸáŸ’áŸ Â· Select Student</label>
      <select class="inp" id="gradeStudentSelect" onchange="onStudentSelect()">
        <option value="">-- á‡áŸ’ášá¾áŸáŸá·áŸáŸ’áŸ --</option>
      </select>
    </div>

    <div id="gradeEntryPanel" style="display:none;">
      <!-- Semester Toggle -->
      <div class="sem-toggle">
        <button class="sem-btn active" id="semBtn1" onclick="setSem('s1')">á†áŸ’á˜á¶áŸ áŸ¡ Â· Sem 1</button>
        <button class="sem-btn" id="semBtn2" onclick="setSem('s2')">á†áŸ’á˜á¶áŸ áŸ¢ Â· Sem 2</button>
      </div>

      <!-- Month Tabs -->
      <div class="month-tabs" id="monthTabs"></div>

      <!-- Score Table -->
      <div class="card" style="padding:12px;">
        <div class="card-title" id="scoreTableTitle">á–á·á“áŸ’á‘á»á”áŸ’ášá…á¶áŸ†ááŸ‚ Â· Monthly Scores</div>
        <table class="score-table">
          <thead>
            <tr>
              <th>áœá·á‰áŸ’á‰á¶áŸá¶</th>
              <th>á˜</th>
              <th style="text-align:right">á–á·á“áŸ’á‘á» /50</th>
            </tr>
          </thead>
          <tbody id="scoreTableBody"></tbody>
        </table>
        <button class="save-month-btn" onclick="saveMonthScores()">
          âœ“ ášá€áŸ’áŸá¶á‘á»á€á–á·á“áŸ’á‘á» Â· Save Scores
        </button>
      </div>

      <!-- Live Averages -->
      <div class="avg-panel">
        <div class="avg-panel-title">á€á¶ášá‚áá“á¶ Â· Live Averages</div>
        <div class="avg-grid">
          <div class="avg-box">
            <div class="avg-val" id="avgS1">â€”</div>
            <div class="avg-lbl">á†áŸ’á˜á¶áŸ áŸ¡</div>
          </div>
          <div class="avg-box">
            <div class="avg-val" id="avgS2">â€”</div>
            <div class="avg-lbl">á†áŸ’á˜á¶áŸ áŸ¢</div>
          </div>
          <div class="avg-box">
            <div class="avg-val" id="avgYearly">â€”</div>
            <div class="avg-lbl">á”áŸ’ášá…á¶áŸ†á†áŸ’á“á¶áŸ†</div>
          </div>
        </div>
        <div style="margin-top:8px;display:flex;align-items:center;justify-content:space-between;">
          <span style="font-size:10px;color:rgba(255,255,255,0.4);">áŸáŸ’áá¶á“á—á¶á– Â· Status</span>
          <span id="avgStatus" style="font-size:11px;font-weight:700;color:#fff;">â€”</span>
        </div>
      </div>
    </div>
    </div><!-- end singleModePanel -->

    <!-- â”€â”€ BULK ENTRY MODE â”€â”€ -->
    <div id="bulkModePanel" style="display:none;">
      <div class="card" style="padding:10px 12px;margin-bottom:10px;">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
          <div>
            <label class="lbl">á˜á»ááœá·á‡áŸ’á‡á¶ Â· Subject</label>
            <select class="inp" id="bulkSubjectSelect" onchange="renderBulkGrid()">
            </select>
          </div>
          <div>
            <label class="lbl">ááŸ‚ Â· Month</label>
            <select class="inp" id="bulkMonthSelect" onchange="renderBulkGrid()">
              <optgroup label="á†áŸ’á˜á¶áŸ áŸ¡ Â· Sem 1">
                <option value="s1_0">áœá·á…áŸ’á†á·á€á¶</option>
                <option value="s1_1">á’áŸ’á“á¼</option>
                <option value="s1_2">á˜á€ášá¶</option>
                <option value="s1_3">á€á»á˜áŸ’á—áŸˆ</option>
                <option value="s1_4">á˜á¸á“á¶</option>
              </optgroup>
              <optgroup label="á†áŸ’á˜á¶áŸ áŸ¢ Â· Sem 2">
                <option value="s2_0">á˜áŸáŸá¶</option>
                <option value="s2_1">á§áŸá—á¶</option>
                <option value="s2_2">á˜á·áá»á“á¶</option>
                <option value="s2_3">á€á€áŸ’á€áŠá¶</option>
                <option value="s2_4">áŸá¸á á¶</option>
              </optgroup>
            </select>
          </div>
        </div>
      </div>

      <div class="card" style="padding:12px;">
        <div class="card-title" id="bulkGridTitle">á–á·á“áŸ’á‘á»ááŸ’á“á¶á€áŸ‹á‘á¶áŸ†á„á˜á¼á› Â· Whole Class Scores</div>
        <div id="bulkGridBody"></div>
        <button class="save-month-btn" style="margin-top:10px;" onclick="saveBulkScores()">
          âœ“ ášá€áŸ’áŸá¶á‘á»á€á‘á¶áŸ†á„á¢áŸáŸ‹ Â· Save All Scores
        </button>
      </div>

      <!-- Bulk class averages summary -->
      <div class="avg-panel" id="bulkAvgPanel" style="display:none;">
        <div class="avg-panel-title">áŸáŸ’áá·áá· Â· Class Stats for this Month</div>
        <div id="bulkAvgContent"></div>
      </div>
    </div>

  </div>
</div>

<!-- â•â• TAB 3: RANKINGS â•â• -->
<div class="page" id="page-rank">
  <div class="sec-title">á…áŸ†áá¶ááŸ‹ááŸ’á“á¶á€áŸ‹</div>
  <div class="sec-sub" id="rankSubtitle">Class Rankings Â· Sorted by yearly average</div>

  <div class="class-stats">
    <div class="cstat">
      <div class="cstat-val" id="statAvg">â€”</div>
      <div class="cstat-lbl">á˜á’áŸ’á™á˜ Â· Avg</div>
    </div>
    <div class="cstat">
      <div class="cstat-val" id="statPassRate">â€”</div>
      <div class="cstat-lbl">á‡á¶á”áŸ‹ Â· Pass%</div>
    </div>
    <div class="cstat">
      <div class="cstat-val" id="statHighest">â€”</div>
      <div class="cstat-lbl">ááŸ’á–áŸáŸ‹ Â· High</div>
    </div>
    <div class="cstat">
      <div class="cstat-val" id="statLowest">â€”</div>
      <div class="cstat-lbl">á‘á¶á” Â· Low</div>
    </div>
  </div>

  <div class="rank-list" id="rankList">
    <div class="no-student"><div class="icon">ğŸ†</div><div>á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á–á·á“áŸ’á‘á» Â· No grades yet</div></div>
  </div>
</div>

<!-- â•â• TAB 4: REPORT â•â• -->
<div class="page" id="page-report">
  <div class="sec-title">ášá”á¶á™á€á¶ášááŸ</div>
  <div class="sec-sub">Student Report Card Â· Share to parent via Telegram</div>

  <div class="card" style="padding:10px 12px;margin-bottom:10px;">
    <label class="lbl">á‡áŸ’ášá¾áŸáŸá·áŸáŸ’áŸ Â· Select Student</label>
    <select class="inp" id="reportStudentSelect" onchange="renderReport()">
      <option value="">-- á‡áŸ’ášá¾áŸáŸá·áŸáŸ’áŸ --</option>
    </select>
  </div>

  <!-- Period filter -->
  <div class="report-period-select" id="reportPeriodBar">
    <button class="period-btn active" onclick="setReportPeriod('yearly')" id="rpYearly">á”áŸ’ášá…á¶áŸ†á†áŸ’á“á¶áŸ†</button>
    <button class="period-btn" onclick="setReportPeriod('s1')" id="rpS1">á†áŸ’á˜á¶áŸ áŸ¡</button>
    <button class="period-btn" onclick="setReportPeriod('s2')" id="rpS2">á†áŸ’á˜á¶áŸ áŸ¢</button>
    <button class="period-btn" onclick="setReportPeriod('m')" id="rpM">á”áŸ’ášá…á¶áŸ†ááŸ‚</button>
  </div>

  <!-- Month selector for monthly report -->
  <div id="reportMonthSelect" style="display:none;margin-bottom:10px;">
    <div style="display:flex;gap:6px;flex-wrap:wrap;">
      <div style="font-size:10px;font-weight:700;color:var(--muted);width:100%;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px;">á‡áŸ’ášá¾áŸááŸ‚ Â· Select Month</div>
      <div id="reportMonthBtns" style="display:flex;gap:4px;flex-wrap:wrap;"></div>
    </div>
  </div>

  <div id="reportContent"></div>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <div class="nav-ind" id="navInd"></div>
  <button class="nav-tab active" id="ntSetup" onclick="goTab('setup')">
    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    ááŸ’á“á¶á€áŸ‹
  </button>
  <button class="nav-tab" id="ntGrades" onclick="goTab('grades')">
    <svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
    á–á·á“áŸ’á‘á»
  </button>
  <button class="nav-tab" id="ntRank" onclick="goTab('rank')">
    <svg viewBox="0 0 24 24"><polyline points="18 20 18 10"/><polyline points="12 20 12 4"/><polyline points="6 20 6 14"/></svg>
    á…áŸ†áá¶ááŸ‹
  </button>
  <button class="nav-tab" id="ntReport" onclick="goTab('report')">
    <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
    ášá”á¶á™á€á¶ášááŸ
  </button>
</nav>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STATE = {
  grade: 7,
  school: '',
  className: '',
  schoolYear: '2024-2025',
  teacher: '',
  students: [],   // {id, name, scores:{subjectId:{s1:[nullÃ—5], s2:[nullÃ—5]}}}
  activeStudentId: null,
  activeSem: 's1',
  activeMonth: 0,
  reportStudentId: null,
  reportPeriod: 'yearly',
  reportMonth: 0,  // 0-4 within semester for monthly
  reportSem: 's1',
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CURRICULUM DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SUBJECTS_BASE = [
  {id:'km', name:'á—á¶áŸá¶ááŸ’á˜áŸ‚áš',        en:'Khmer Language',   coef:2},
  {id:'ma', name:'á‚áá·ááœá·á‘áŸ’á™á¶',        en:'Mathematics',      coef:2},
  {id:'en', name:'á—á¶áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸ',     en:'English',          coef:2},
  {id:'ph', name:'ášá¼á”áœá·á‘áŸ’á™á¶',         en:'Physics',          coef:1},
  {id:'bi', name:'á‡á¸áœáœá·á‘áŸ’á™á¶',         en:'Biology',          coef:1},
  {id:'hi', name:'á”áŸ’ášáœááŸ’áá·áœá·á‘áŸ’á™á¶',   en:'History',          coef:1},
  {id:'ge', name:'á—á¼á˜á·áœá·á‘áŸ’á™á¶',        en:'Geography',        coef:1},
  {id:'mo', name:'áŸá¸á›á’á˜áŸŒ-á–á›ášáŠáŸ’á‹',   en:'Moral & Civics',   coef:1},
  {id:'it', name:'á–áŸááŸŒá˜á¶á“áœá·á‘áŸ’á™á¶',    en:'Computer Science', coef:1},
];
const CHEM = {id:'ch', name:'á‚á¸á˜á¸áœá·á‘áŸ’á™á¶', en:'Chemistry', coef:1};

function getSubjects(grade){
  if(grade === 7) return SUBJECTS_BASE;
  return [...SUBJECTS_BASE.slice(0,4), CHEM, ...SUBJECTS_BASE.slice(4)];
}

const MONTHS_S1 = ['áœá·á…áŸ’á†á·á€á¶','á’áŸ’á“á¼','á˜á€ášá¶','á€á»á˜áŸ’á—áŸˆ','á˜á¸á“á¶'];
const MONTHS_S2 = ['á˜áŸáŸá¶','á§áŸá—á¶','á˜á·áá»á“á¶','á€á€áŸ’á€áŠá¶','áŸá¸á á¶'];
const MONTHS_S1_SHORT = ['áœá·á…','á’áŸ’á“á¼','á˜á€','á€á»','á˜á¸'];
const MONTHS_S2_SHORT = ['á˜áŸ','á§','á˜á·','á€á€','áŸá¸'];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALCULATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function semAvg(scores, sem){
  const arr = (scores[sem] || []).filter(v => v !== null && v !== '' && !isNaN(parseFloat(v)));
  if(!arr.length) return null;
  return arr.reduce((a,b)=>a+parseFloat(b),0) / arr.length;
}

function yearlyAvg(scores){
  const s1 = semAvg(scores,'s1'), s2 = semAvg(scores,'s2');
  if(s1===null && s2===null) return null;
  if(s1===null) return s2;
  if(s2===null) return s1;
  return (s1+s2)/2;
}

function studentWeightedAvg(student, sem){
  const subs = getSubjects(STATE.grade);
  let tw=0, tc=0;
  subs.forEach(s=>{
    const sc = student.scores[s.id] || {};
    let avg;
    if(sem === 'yearly') avg = yearlyAvg(sc);
    else avg = semAvg(sc, sem);
    if(avg !== null){ tw += avg*s.coef; tc += s.coef; }
  });
  return tc>0 ? tw/tc : null;
}

function calcClassStats(){
  const ranked = STATE.students
    .map(st=>({...st, avg: studentWeightedAvg(st,'yearly')}))
    .filter(st=>st.avg!==null)
    .sort((a,b)=>b.avg-a.avg);
  if(!ranked.length) return null;
  const avgs = ranked.map(s=>s.avg);
  return {
    ranked,
    classAvg: avgs.reduce((a,b)=>a+b,0)/avgs.length,
    passCount: avgs.filter(a=>a>=25).length,
    highest: Math.max(...avgs),
    lowest: Math.min(...avgs),
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRADE LEVEL SWITCHING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setGrade(g){
  STATE.grade = g;
  document.querySelectorAll('.grade-pill').forEach((el,i)=>{
    el.classList.toggle('active',[7,8,9][i]===g);
  });
  // Add new subjects to existing students
  STATE.students.forEach(st=>{
    const subs = getSubjects(g);
    subs.forEach(s=>{
      if(!st.scores[s.id]) st.scores[s.id] = {s1:[null,null,null,null,null],s2:[null,null,null,null,null]};
    });
  });
  renderSubjectRef();
  renderGradeEntry();
  renderRankings();
  renderReport();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TABS = ['setup','grades','rank','report'];
function goTab(t){
  TABS.forEach(id=>{
    document.getElementById('page-'+id).classList.toggle('active',id===t);
    document.getElementById('nt'+cap(id)).classList.toggle('active',id===t);
  });
  const idx = TABS.indexOf(t);
  document.getElementById('navInd').style.left = (idx*25)+'%';
  if(t==='grades') refreshGradesTab();
  if(t==='rank') renderRankings();
  if(t==='report') refreshReportTab();
}
function cap(s){return s.charAt(0).toUpperCase()+s.slice(1);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETUP TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveSetup(){
  STATE.school = document.getElementById('schoolName').value.trim() || 'áŸá¶á›á¶ášá”áŸáŸ‹á™á¾á„';
  STATE.className = document.getElementById('className').value.trim() || '';
  STATE.schoolYear = document.getElementById('schoolYear').value.trim() || '2024-2025';
  STATE.teacher = document.getElementById('teacherName').value.trim() || '';
  document.getElementById('tbSub').textContent =
    `${STATE.school}${STATE.className?' Â· ááŸ’á“á¶á€áŸ‹'+STATE.className:''}`;
  saveData();
  showToast('âœ… ášá€áŸ’áŸá¶á‘á»á€ášá½á… Â· Saved!');
}

function addStudent(){
  const inp = document.getElementById('newStudentName');
  const name = inp.value.trim();
  if(!name) return;
  const id = 'st_' + Date.now();
  const scores = {};
  getSubjects(STATE.grade).forEach(s=>{
    scores[s.id] = {s1:[null,null,null,null,null],s2:[null,null,null,null,null]};
  });
  STATE.students.push({id, name, scores});
  inp.value = '';
  renderStudentList();
  updateStudentSelects();
  saveData();
}

function deleteStudent(id){
  if(!confirm('á›á»á”áŸá·áŸáŸ’áŸá“áŸáŸ‡? Delete this student?')) return;
  STATE.students = STATE.students.filter(s=>s.id!==id);
  if(STATE.activeStudentId===id) STATE.activeStudentId=null;
  if(STATE.reportStudentId===id) STATE.reportStudentId=null;
  renderStudentList();
  updateStudentSelects();
  renderGradeEntry();
  renderRankings();
  saveData();
}

function renderStudentList(){
  const container = document.getElementById('studentList');
  document.getElementById('studentCount').textContent = STATE.students.length;
  if(!STATE.students.length){
    container.innerHTML = '<div class="empty-hint"><div>ğŸ“‹</div><div>á˜á·á“á‘á¶á“áŸ‹á˜á¶á“áŸá·áŸáŸ’áŸ Â· No students yet</div></div>';
    return;
  }
  container.innerHTML = STATE.students.map((st,i)=>`
    <div class="student-item">
      <div class="si-num">${i+1}</div>
      <div class="si-name">${st.name}</div>
      <button class="btn-del" onclick="deleteStudent('${st.id}')">âœ•</button>
    </div>
  `).join('');
}

function renderSubjectRef(){
  const subs = getSubjects(STATE.grade);
  const totalCoef = subs.reduce((a,s)=>a+s.coef,0);
  document.getElementById('subjectRef').innerHTML = `
    <div style="display:flex;flex-direction:column;gap:4px;">
      ${subs.map(s=>`
        <div style="display:flex;align-items:center;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--cream2);">
          <div>
            <span style="font-size:12px;font-weight:600;color:var(--text);">${s.name}</span>
            <span style="font-size:10px;color:var(--muted);margin-left:4px;">${s.en}</span>
          </div>
          <span style="font-family:'DM Mono',monospace;font-size:11px;font-weight:700;color:var(--gold);">Ã—${s.coef}</span>
        </div>
      `).join('')}
      <div style="display:flex;justify-content:space-between;padding-top:6px;">
        <span style="font-size:11px;font-weight:700;color:var(--muted);">á˜áŸ‰áŸ‚ááŸ’ášáŸášá»á” Â· Total Coefficient</span>
        <span style="font-family:'DM Mono',monospace;font-size:11px;font-weight:700;color:var(--navy);">${totalCoef}</span>
      </div>
    </div>
    <div style="margin-top:8px;padding:8px;background:var(--cream2);border-radius:8px;font-size:11px;color:var(--muted);">
      âœ” á‡á¶á”áŸ‹ (Pass) = á˜á’áŸ’á™á˜á—á¶á‚ â‰¥ 25/50 Â· á’áŸ’á›á¶á€áŸ‹ (Fail) &lt; 25/50
    </div>
  `;
}

function updateStudentSelects(){
  const opts = STATE.students.length
    ? '<option value="">-- á‡áŸ’ášá¾áŸáŸá·áŸáŸ’áŸ --</option>' + STATE.students.map(st=>`<option value="${st.id}">${st.name}</option>`).join('')
    : '<option value="">-- á˜á·á“á‘á¶á“áŸ‹á˜á¶á“áŸá·áŸáŸ’áŸ --</option>';
  document.getElementById('gradeStudentSelect').innerHTML = opts;
  document.getElementById('reportStudentSelect').innerHTML = opts;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRADES TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function refreshGradesTab(){
  if(!STATE.students.length){
    document.getElementById('gradesNoStudents').style.display = 'block';
    document.getElementById('gradesContent').style.display = 'none';
  } else {
    document.getElementById('gradesNoStudents').style.display = 'none';
    document.getElementById('gradesContent').style.display = 'block';
  }
  updateStudentSelects();
  renderGradeEntry();
}

function onStudentSelect(){
  const val = document.getElementById('gradeStudentSelect').value;
  STATE.activeStudentId = val || null;
  renderGradeEntry();
}

function setSem(sem){
  STATE.activeSem = sem;
  STATE.activeMonth = 0;
  document.getElementById('semBtn1').classList.toggle('active', sem==='s1');
  document.getElementById('semBtn2').classList.toggle('active', sem==='s2');
  renderMonthTabs();
  renderScoreTable();
  updateLiveAverages();
}

function renderGradeEntry(){
  const panel = document.getElementById('gradeEntryPanel');
  if(!STATE.activeStudentId){ panel.style.display='none'; return; }
  panel.style.display = 'block';
  renderMonthTabs();
  renderScoreTable();
  updateLiveAverages();
}

function renderMonthTabs(){
  const months = STATE.activeSem==='s1' ? MONTHS_S1_SHORT : MONTHS_S2_SHORT;
  const st = STATE.students.find(s=>s.id===STATE.activeStudentId);
  const sem = STATE.activeSem;
  document.getElementById('monthTabs').innerHTML = months.map((m,i)=>{
    const hasData = st && getSubjects(STATE.grade).some(s=>{
      const v = (st.scores[s.id]||{})[sem]?.[i];
      return v!==null && v!=='' && !isNaN(parseFloat(v));
    });
    return `<button class="month-btn${i===STATE.activeMonth?' active':''}${hasData?' has-data':''}" onclick="selectMonth(${i})">${m}</button>`;
  }).join('');
}

function selectMonth(i){
  STATE.activeMonth = i;
  renderMonthTabs();
  renderScoreTable();
}

function renderScoreTable(){
  const st = STATE.students.find(s=>s.id===STATE.activeStudentId);
  if(!st) return;
  const subs = getSubjects(STATE.grade);
  const sem = STATE.activeSem;
  const mi = STATE.activeMonth;
  const months = sem==='s1' ? MONTHS_S1 : MONTHS_S2;

  document.getElementById('scoreTableTitle').textContent =
    `á–á·á“áŸ’á‘á» ${months[mi]} Â· ${months[mi]} Scores`;

  document.getElementById('scoreTableBody').innerHTML = subs.map((s,idx)=>{
    const val = (st.scores[s.id]||{})[sem]?.[mi];
    const disp = (val!==null && val!==undefined && val!=='') ? val : '';
    return `
      <tr>
        <td><div class="sub-name-cell">${s.name}</div></td>
        <td><div class="sub-coef-cell">Ã—${s.coef}</div></td>
        <td>
          <input type="number" class="score-inp" id="sc_${s.id}"
            min="0" max="50" placeholder="â€”" value="${disp}"
            oninput="validateScore(this)" onchange="validateScore(this)">
        </td>
      </tr>`;
  }).join('');
}

function validateScore(el){
  const v = parseFloat(el.value);
  el.classList.toggle('err', el.value!=='' && (v<0||v>50));
}

function saveMonthScores(){
  const st = STATE.students.find(s=>s.id===STATE.activeStudentId);
  if(!st) return;
  const subs = getSubjects(STATE.grade);
  let hasErr = false;
  subs.forEach(s=>{
    const inp = document.getElementById('sc_'+s.id);
    if(inp.classList.contains('err')){ hasErr=true; return; }
    const val = inp.value.trim();
    if(!st.scores[s.id]) st.scores[s.id]={s1:[null,null,null,null,null],s2:[null,null,null,null,null]};
    st.scores[s.id][STATE.activeSem][STATE.activeMonth] = val==='' ? null : parseFloat(val);
  });
  if(hasErr){ alert('âš  á–á·á“áŸ’á‘á»ááŸ’á›áŸ‡á á½áŸ 50 Â· Some scores exceed 50'); return; }
  renderMonthTabs();
  updateLiveAverages();
  saveData();
  showToast('âœ… ášá€áŸ’áŸá¶á‘á»á€ášá½á…!');
}

function updateLiveAverages(){
  const st = STATE.students.find(s=>s.id===STATE.activeStudentId);
  if(!st){ ['avgS1','avgS2','avgYearly','avgStatus'].forEach(id=>document.getElementById(id).textContent='â€”'); return; }
  const s1 = studentWeightedAvg(st,'s1');
  const s2 = studentWeightedAvg(st,'s2');
  const yr = studentWeightedAvg(st,'yearly');
  document.getElementById('avgS1').textContent = s1!==null ? s1.toFixed(1) : 'â€”';
  document.getElementById('avgS2').textContent = s2!==null ? s2.toFixed(1) : 'â€”';
  document.getElementById('avgYearly').textContent = yr!==null ? yr.toFixed(1) : 'â€”';
  if(yr!==null){
    const pass = yr>=25;
    document.getElementById('avgStatus').textContent = pass ? 'âœ… á‡á¶á”áŸ‹ Â· PASS' : 'âŒ á’áŸ’á›á¶á€áŸ‹ Â· FAIL';
    document.getElementById('avgStatus').style.color = pass ? '#4ade80' : '#f87171';
  } else {
    document.getElementById('avgStatus').textContent = 'â³ á˜á·á“á‘á¶á“áŸ‹á‚áŸ’ášá”áŸ‹';
    document.getElementById('avgStatus').style.color = 'rgba(255,255,255,0.5)';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RANKINGS TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderRankings(){
  const stats = calcClassStats();
  const container = document.getElementById('rankList');
  const info = `${STATE.school || 'ááŸ’á“á¶á€áŸ‹'}${STATE.className?' ááŸ’á“á¶á€áŸ‹'+STATE.className:''} Â· á‘á¸${STATE.grade}`;
  document.getElementById('rankSubtitle').textContent = info;

  if(!stats){
    document.getElementById('statAvg').textContent = 'â€”';
    document.getElementById('statPassRate').textContent = 'â€”';
    document.getElementById('statHighest').textContent = 'â€”';
    document.getElementById('statLowest').textContent = 'â€”';
    container.innerHTML = '<div class="no-student"><div class="icon">ğŸ†</div><div>á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á–á·á“áŸ’á‘á» Â· No grades yet</div></div>';
    return;
  }

  document.getElementById('statAvg').textContent = stats.classAvg.toFixed(1);
  document.getElementById('statPassRate').textContent = Math.round(stats.passCount/stats.ranked.length*100)+'%';
  document.getElementById('statHighest').textContent = stats.highest.toFixed(1);
  document.getElementById('statLowest').textContent = stats.lowest.toFixed(1);

  container.innerHTML = stats.ranked.map((st,i)=>{
    const rank = i+1;
    const pass = st.avg>=25;
    const medalClass = rank===1?'m1':rank===2?'m2':rank===3?'m3':'mn';
    const medalText = rank<=3?['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][rank-1]:rank;
    const barColor = pass?(st.avg>=80?'#1a6b42':'#2d8a5c'):'#c0272d';
    return `
      <div class="rank-card">
        <div class="medal ${medalClass}">${medalText}</div>
        <div class="rank-info">
          <div class="rank-name">${st.name}</div>
          <div class="rank-detail">
            <span class="rank-badge ${pass?'badge-pass':'badge-fail'}">${pass?'á‡á¶á”áŸ‹':'á’áŸ’á›á¶á€áŸ‹'}</span>
          </div>
          <div class="progress-bar-wrap" style="margin-top:5px;">
            <div class="progress-bar" style="width:${Math.min(st.avg,100)}%;background:${barColor}"></div>
          </div>
        </div>
        <div class="rank-right">
          <div class="rank-avg">${st.avg.toFixed(1)}</div>
          <button class="tg-mini" title="Share to Telegram" onclick="shareStudentTelegram('${st.id}','yearly')">âœˆ</button>
        </div>
      </div>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REPORT TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setReportPeriod(p){
  STATE.reportPeriod = p;
  ['Yearly','S1','S2','M'].forEach(id=>{
    document.getElementById('rp'+id).classList.toggle('active',
      (id==='Yearly'&&p==='yearly')||(id==='S1'&&p==='s1')||(id==='S2'&&p==='s2')||(id==='M'&&p==='m'));
  });
  document.getElementById('reportMonthSelect').style.display = p==='m'?'block':'none';
  renderReport();
}

function refreshReportTab(){
  updateStudentSelects();
  // Render month buttons for report
  const allMonths = [...MONTHS_S1.map((m,i)=>({name:m,sem:'s1',mi:i})), ...MONTHS_S2.map((m,i)=>({name:m,sem:'s2',mi:i}))];
  document.getElementById('reportMonthBtns').innerHTML = allMonths.map((m,i)=>
    `<button class="month-btn${i===0&&STATE.reportPeriod==='m'?' active':''}" onclick="selectReportMonth('${m.sem}',${m.mi},this)">${m.name}</button>`
  ).join('');
  renderReport();
}

function selectReportMonth(sem,mi,btn){
  STATE.reportSem = sem;
  STATE.reportMonth = mi;
  document.querySelectorAll('#reportMonthBtns .month-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderReport();
}

function renderReport(){
  const stId = document.getElementById('reportStudentSelect').value;
  STATE.reportStudentId = stId||null;
  const container = document.getElementById('reportContent');
  if(!stId){ container.innerHTML=''; return; }
  const st = STATE.students.find(s=>s.id===stId);
  if(!st){ container.innerHTML=''; return; }
  const subs = getSubjects(STATE.grade);
  const p = STATE.reportPeriod;

  // Determine title & what to show
  let periodLabel='';
  if(p==='yearly') periodLabel='á”áŸ’ášá…á¶áŸ†á†áŸ’á“á¶áŸ† Â· Full Year';
  else if(p==='s1') periodLabel='á†áŸ’á˜á¶áŸ áŸ¡ Â· Semester 1';
  else if(p==='s2') periodLabel='á†áŸ’á˜á¶áŸ áŸ¢ Â· Semester 2';
  else {
    const mn = STATE.reportSem==='s1'?MONTHS_S1[STATE.reportMonth]:MONTHS_S2[STATE.reportMonth];
    periodLabel = mn + ' Â· Monthly';
  }

  // Header
  let html = `
    <div class="report-header">
      <div class="report-seal">ğŸ“</div>
      <div class="report-school">${STATE.school||'áˆáŸ’á˜áŸ„áŸ‡áŸá¶á›á¶'} ${STATE.className?'Â· ááŸ’á“á¶á€áŸ‹'+STATE.className:''}</div>
      <div class="report-student">${st.name}</div>
      <div class="report-meta">ááŸ’á“á¶á€áŸ‹á‘á¸ ${STATE.grade} Â· ${STATE.schoolYear} Â· ${periodLabel}</div>
    </div>`;

  // Subject breakdown
  html += `<div class="card"><div class="card-title">á–á·á“áŸ’á‘á»áá¶á˜á˜á»ááœá·á‡áŸ’á‡á¶ Â· Subject Scores</div>`;

  subs.forEach(s=>{
    const sc = st.scores[s.id]||{s1:[null,null,null,null,null],s2:[null,null,null,null,null]};
    let chips='', avgLabel='', avgVal=null;

    if(p==='m'){
      // show single month
      const val = sc[STATE.reportSem]?.[STATE.reportMonth];
      chips = `<span class="score-chip ${val===null||val===''?'empty':''}">${val!==null&&val!==''?val:'â€”'}</span>`;
      avgVal = (val!==null&&val!==''&&!isNaN(val)) ? parseFloat(val) : null;
    } else if(p==='s1'||p==='s2'){
      const months = p==='s1'?MONTHS_S1_SHORT:MONTHS_S2_SHORT;
      chips = months.map((m,i)=>{
        const v = sc[p]?.[i]; const disp = v!==null&&v!==''&&!isNaN(v)?v:'â€”';
        return `<span class="score-chip${v===null||v===''?' empty':''}" title="${p==='s1'?MONTHS_S1[i]:MONTHS_S2[i]}">${disp}</span>`;
      }).join('');
      const sa = semAvg(sc,p);
      if(sa!==null) chips += `<span class="score-chip avg">${sa.toFixed(1)}</span>`;
      avgVal = sa;
    } else {
      // yearly: show both sems
      const s1chips = MONTHS_S1_SHORT.map((m,i)=>{const v=sc.s1?.[i];return `<span class="score-chip${v===null||v===''?' empty':''}">${v!==null&&v!==''&&!isNaN(v)?v:'â€”'}</span>`;}).join('');
      const s1a = semAvg(sc,'s1');
      const s2chips = MONTHS_S2_SHORT.map((m,i)=>{const v=sc.s2?.[i];return `<span class="score-chip${v===null||v===''?' empty':''}">${v!==null&&v!==''&&!isNaN(v)?v:'â€”'}</span>`;}).join('');
      const s2a = semAvg(sc,'s2');
      const ya = yearlyAvg(sc);
      chips = `<span style="font-size:9px;color:var(--muted);margin-right:2px;">S1:</span>${s1chips}${s1a!==null?`<span class="score-chip avg">${s1a.toFixed(1)}</span>`:''}
               <span style="font-size:9px;color:var(--muted);margin:0 2px;">S2:</span>${s2chips}${s2a!==null?`<span class="score-chip avg">${s2a.toFixed(1)}</span>`:''}
               ${ya!==null?`<span class="score-chip yearly">${ya.toFixed(1)}</span>`:''}`;
      avgVal = ya;
    }

    const passColor = avgVal!==null ? (avgVal>=25?'var(--pass-fg)':'var(--red)') : 'var(--muted)';
    html += `
      <div class="sub-report-row">
        <div>
          <div class="sr-name">${s.name} <span class="sr-coef">Ã—${s.coef}</span></div>
        </div>
        <div class="sr-scores" style="flex:1;justify-content:flex-end;">${chips}</div>
      </div>`;
  });
  html += `</div>`;

  // Summary
  const sem = (p==='s1'||p==='s2') ? p : (p==='m'?STATE.reportSem:'yearly');
  const wAvg = p==='yearly' ? studentWeightedAvg(st,'yearly') :
               p==='m' ? null :
               studentWeightedAvg(st, sem);
  const pass = wAvg!==null && wAvg>=25;
  const rank = calcClassStats();
  const rankPos = rank ? rank.ranked.findIndex(r=>r.id===st.id)+1 : null;

  html += `<div class="summary-card">
    <div class="summary-grid">
      <div class="sum-box">
        <div class="sum-val">${wAvg!==null?wAvg.toFixed(2):'â€”'}</div>
        <div class="sum-lbl">á˜á’áŸ’á™á˜ Â· Avg</div>
      </div>
      <div class="sum-box">
        <div class="sum-val">${rankPos&&p==='yearly'?'#'+rankPos:'â€”'}</div>
        <div class="sum-lbl">á…áŸ†áá¶ááŸ‹ Â· Rank</div>
      </div>
    </div>
    ${wAvg!==null?`
    <div class="sum-status" style="background:${pass?'rgba(26,107,66,0.3)':'rgba(192,39,45,0.3)'};color:${pass?'#4ade80':'#f87171'}">
      ${pass?'ğŸ‰ á‡á¶á”áŸ‹ Â· PASS âœ“':'âŒ á’áŸ’á›á¶á€áŸ‹ Â· FAIL'}
    </div>`:`<div class="sum-status" style="background:rgba(255,255,255,0.07);color:rgba(255,255,255,0.5)">â³ á‘á·á“áŸ’á“á“áŸá™á˜á·á“á‚áŸ’ášá”áŸ‹</div>`}
    <div class="action-row">
      <button class="action-btn btn-tg" onclick="shareStudentTelegram('${st.id}','${p}')" style="background:#0088cc;color:#fff;">
        âœˆ Telegram á•áŸ’á‰á¾á‘áŸ…áªá–á»á€á˜áŸ’áá¶á™
      </button>
      <button class="action-btn" onclick="window.print()" style="background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.8);border:1px solid rgba(255,255,255,0.15);">
        ğŸ–¨ Print
      </button>
    </div>
  </div>`;

  container.innerHTML = html;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TELEGRAM SHARING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function shareStudentTelegram(stId, period){
  const st = STATE.students.find(s=>s.id===stId);
  if(!st){ alert('á˜á·á“áƒá¾á‰áŸá·áŸáŸ’áŸ Â· Student not found'); return; }
  const subs = getSubjects(STATE.grade);
  const school = STATE.school || 'áŸá¶á›á¶';
  const cls = STATE.className ? ' ááŸ’á“á¶á€áŸ‹'+STATE.className : '';
  const yr = STATE.schoolYear;
  const teacher = STATE.teacher || 'á‚áŸ’ášá¼';

  let periodLabel='', scoreLines='';
  const wAvg = period==='yearly' ? studentWeightedAvg(st,'yearly') :
               (period==='s1'||period==='s2') ? studentWeightedAvg(st,period) : null;

  if(period==='yearly'){
    periodLabel = 'á”áŸ’ášá…á¶áŸ†á†áŸ’á“á¶áŸ† (Full Year)';
    scoreLines = subs.map(s=>{
      const sc = st.scores[s.id]||{};
      const s1a = semAvg(sc,'s1'), s2a = semAvg(sc,'s2'), ya = yearlyAvg(sc);
      const s1t = s1a!==null?s1a.toFixed(1):'â€”', s2t = s2a!==null?s2a.toFixed(1):'â€”';
      const yat = ya!==null?ya.toFixed(1):'â€”';
      return `  ğŸ“Œ ${s.name} (Ã—${s.coef}): S1=${s1t} | S2=${s2t} | á†áŸ’á“á¶áŸ†=${yat}`;
    }).join('\n');
  } else if(period==='s1'||period==='s2'){
    const sLabel = period==='s1'?'á†áŸ’á˜á¶áŸ áŸ¡':'á†áŸ’á˜á¶áŸ áŸ¢';
    periodLabel = sLabel;
    const months = period==='s1'?MONTHS_S1:MONTHS_S2;
    scoreLines = subs.map(s=>{
      const sc = st.scores[s.id]||{};
      const mscores = (sc[period]||[]).map((v,i)=>`${MONTHS_S1_SHORT.concat(MONTHS_S2_SHORT)[period==='s1'?i:i+5]}:${v!==null&&v!==''?v:'â€”'}`).join(' ');
      const sa = semAvg(sc,period);
      return `  ğŸ“Œ ${s.name}: ${mscores} | á˜á’áŸ’á™á˜=${sa!==null?sa.toFixed(1):'â€”'}`;
    }).join('\n');
  } else {
    const mn = STATE.reportSem==='s1'?MONTHS_S1[STATE.reportMonth]:MONTHS_S2[STATE.reportMonth];
    periodLabel = mn + ' (á”áŸ’ášá…á¶áŸ†ááŸ‚)';
    scoreLines = subs.map(s=>{
      const sc = st.scores[s.id]||{};
      const v = sc[STATE.reportSem]?.[STATE.reportMonth];
      return `  ğŸ“Œ ${s.name} (Ã—${s.coef}): ${v!==null&&v!==''?v:'â€”'}/50`;
    }).join('\n');
  }

  const pass = wAvg!==null && wAvg>=25;
  const statusLine = wAvg!==null ? `\nğŸ“Š á˜á’áŸ’á™á˜á—á¶á‚: ${wAvg.toFixed(2)}/50\n${pass?'ğŸ‰ áŸáŸ’áá¶á“á—á¶á–: á‡á¶á”áŸ‹ Â· PASS âœ“':'âŒ áŸáŸ’áá¶á“á—á¶á–: á’áŸ’á›á¶á€áŸ‹ Â· FAIL'}` : '';

  const msg =
`ğŸ« ${school}${cls}
ğŸ“… á†áŸ’á“á¶áŸ†áŸá·á€áŸ’áŸá¶ ${yr} Â· ááŸ’á“á¶á€áŸ‹á‘á¸ ${STATE.grade}
ğŸ‘¤ áŸá·áŸáŸ’áŸ: ${st.name}
ğŸ“‹ ášá”á¶á™á€á¶ášááŸ: ${periodLabel}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
${scoreLines}${statusLine}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘¨â€ğŸ« ${teacher}
ğŸ”” ášá”á¶á™á€á¶ášááŸá•áŸ’á‰á¾áŠáŸ„á™á”áŸ’ášá–áŸá“áŸ’á’ BacII Grade System`;

  window.open(`https://t.me/share/url?url=https://moeys.gov.kh&text=${encodeURIComponent(msg)}`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(msg){
  let t = document.getElementById('toast');
  if(!t){
    t = document.createElement('div');
    t.id = 'toast';
    t.style.cssText = `position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--navy);color:#fff;padding:10px 18px;border-radius:99px;font-size:12px;font-weight:700;z-index:999;opacity:0;transition:opacity 0.3s;pointer-events:none;white-space:nowrap;box-shadow:0 4px 16px rgba(0,0,0,0.2);`;
    document.body.appendChild(t);
  }
  t.textContent = msg;
  t.style.opacity = '1';
  setTimeout(()=>t.style.opacity='0', 2000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOCALSTORAGE PERSISTENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STORAGE_KEY = 'bacii_grade_system_v1';

function saveData(){
  try{
    const payload = {
      grade: STATE.grade,
      school: STATE.school,
      className: STATE.className,
      schoolYear: STATE.schoolYear,
      teacher: STATE.teacher,
      students: STATE.students,
      savedAt: new Date().toISOString(),
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    // Flash the save indicator
    const s = document.getElementById('saveStatus');
    if(s){ s.style.color='rgba(74,222,128,0.9)'; setTimeout(()=>{ s.style.color='rgba(255,255,255,0.35)'; },1200); }
  } catch(e){ console.warn('Save failed',e); }
}

function loadData(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return false;
    const d = JSON.parse(raw);
    STATE.grade     = d.grade || 7;
    STATE.school    = d.school || '';
    STATE.className = d.className || '';
    STATE.schoolYear= d.schoolYear || '2024-2025';
    STATE.teacher   = d.teacher || '';
    STATE.students  = d.students || [];
    return true;
  } catch(e){ return false; }
}

function clearAllData(){
  if(!confirm('âš  á“á¹á„á›á»á”á‘á·á“áŸ’á“á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹!\nDelete ALL data? This cannot be undone.')) return;
  localStorage.removeItem(STORAGE_KEY);
  STATE.students = [];
  STATE.school = STATE.className = STATE.schoolYear = STATE.teacher = '';
  ['schoolName','className','schoolYear','teacherName'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
  document.getElementById('tbSub').textContent = 'Grade Management System Â· MoEYS';
  renderStudentList();
  updateStudentSelects();
  renderRankings();
  renderSubjectRef();
  showToast('ğŸ—‘ á”á¶á“á›á»á”á‘á¶áŸ†á„á¢áŸáŸ‹ Â· All data cleared');
}

function exportData(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY) || JSON.stringify({students:STATE.students});
    const blob = new Blob([raw],{type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `bacii_backup_${Date.now()}.json`; a.click();
    URL.revokeObjectURL(url);
    showToast('ğŸ“¤ Export á‡áŸ„á‚á‡áŸá™!');
  } catch(e){ alert('Export failed: '+e.message); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BULK GRADE ENTRY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
STATE.gradeMode = 'single';

function setGradeMode(mode){
  STATE.gradeMode = mode;
  document.getElementById('modeSingle').classList.toggle('active', mode==='single');
  document.getElementById('modeBulk').classList.toggle('active', mode==='bulk');
  document.getElementById('singleModePanel').style.display  = mode==='single' ? 'block' : 'none';
  document.getElementById('bulkModePanel').style.display    = mode==='bulk'   ? 'block' : 'none';
  if(mode==='bulk') initBulkPanel();
}

function initBulkPanel(){
  // Populate subject dropdown
  const sel = document.getElementById('bulkSubjectSelect');
  const subs = getSubjects(STATE.grade);
  sel.innerHTML = subs.map(s=>`<option value="${s.id}">${s.name} (Ã—${s.coef})</option>`).join('');
  renderBulkGrid();
}

function renderBulkGrid(){
  if(!STATE.students.length){ 
    document.getElementById('bulkGridBody').innerHTML = '<div class="empty-hint"><div>ğŸ“‹</div><div>á˜á·á“á‘á¶á“áŸ‹á˜á¶á“áŸá·áŸáŸ’áŸ Â· No students</div></div>';
    document.getElementById('bulkAvgPanel').style.display='none';
    return;
  }
  const subId  = document.getElementById('bulkSubjectSelect').value;
  const mVal   = document.getElementById('bulkMonthSelect').value;   // e.g. "s1_2"
  const [sem, miStr] = mVal.split('_');
  const mi = parseInt(miStr);
  const monthName = sem==='s1' ? MONTHS_S1[mi] : MONTHS_S2[mi];
  const subName = getSubjects(STATE.grade).find(s=>s.id===subId)?.name || '';

  document.getElementById('bulkGridTitle').textContent = `${subName} Â· ${monthName}`;

  // Rows
  document.getElementById('bulkGridBody').innerHTML = STATE.students.map((st,i)=>{
    const val = (st.scores[subId]||{})[sem]?.[mi];
    const disp = (val!==null && val!==undefined && val!=='') ? val : '';
    // show semester avg as hint
    const semA = semAvg(st.scores[subId]||{}, sem);
    const hint = semA!==null ? semA.toFixed(0) : 'â€”';
    return `
      <div class="bulk-row">
        <div class="bulk-num">${i+1}</div>
        <div class="bulk-name">${st.name}</div>
        <div class="bulk-prev" title="á†áŸ’á˜á¶áŸá˜á’áŸ’á™á˜">${hint}</div>
        <input type="number" class="bulk-inp" id="bulk_${st.id}"
          min="0" max="50" placeholder="â€”" value="${disp}"
          oninput="onBulkInput(this)" onchange="onBulkInput(this)">
      </div>`;
  }).join('');

  updateBulkStats(subId, sem, mi);
}

function onBulkInput(el){
  const v = parseFloat(el.value);
  el.classList.toggle('err', el.value!=='' && (v<0||v>50));
  // live stats
  const subId = document.getElementById('bulkSubjectSelect').value;
  const [sem, miStr] = document.getElementById('bulkMonthSelect').value.split('_');
  updateBulkStats(subId, sem, parseInt(miStr));
}

function updateBulkStats(subId, sem, mi){
  const vals = STATE.students.map(st=>{
    const inp = document.getElementById('bulk_'+st.id);
    const v = inp ? parseFloat(inp.value) : parseFloat((st.scores[subId]||{})[sem]?.[mi]);
    return isNaN(v)?null:v;
  }).filter(v=>v!==null);

  if(!vals.length){ document.getElementById('bulkAvgPanel').style.display='none'; return; }
  document.getElementById('bulkAvgPanel').style.display='block';
  const avg = vals.reduce((a,b)=>a+b,0)/vals.length;
  const passN = vals.filter(v=>v>=25).length;
  const highest = Math.max(...vals);
  const lowest  = Math.min(...vals);

  document.getElementById('bulkAvgContent').innerHTML = `
    <div class="bulk-avg-row"><span class="bulk-avg-name">á˜á’áŸ’á™á˜ Â· Average</span><span class="bulk-avg-val">${avg.toFixed(1)}</span></div>
    <div class="bulk-avg-row"><span class="bulk-avg-name">ááŸ’á–áŸáŸ‹ Â· Highest</span><span class="bulk-avg-val">${highest}</span></div>
    <div class="bulk-avg-row"><span class="bulk-avg-name">á‘á¶á” Â· Lowest</span><span class="bulk-avg-val">${lowest}</span></div>
    <div class="bulk-avg-row"><span class="bulk-avg-name">á‡á¶á”áŸ‹ Â· Pass (â‰¥50)</span><span class="bulk-avg-val">${passN}/${vals.length}</span></div>
  `;
}

function saveBulkScores(){
  const subId = document.getElementById('bulkSubjectSelect').value;
  const mVal  = document.getElementById('bulkMonthSelect').value;
  const [sem, miStr] = mVal.split('_');
  const mi = parseInt(miStr);
  let hasErr = false;

  STATE.students.forEach(st=>{
    const inp = document.getElementById('bulk_'+st.id);
    if(!inp) return;
    if(inp.classList.contains('err')){ hasErr=true; return; }
    if(!st.scores[subId]) st.scores[subId]={s1:[null,null,null,null,null],s2:[null,null,null,null,null]};
    const val = inp.value.trim();
    st.scores[subId][sem][mi] = val==='' ? null : parseFloat(val);
  });

  if(hasErr){ alert('âš  á–á·á“áŸ’á‘á»ááŸ’á›áŸ‡á á½áŸ 50!'); return; }
  saveData();
  renderRankings();
  updateBulkStats(subId, sem, mi);
  showToast(`âœ… ášá€áŸ’áŸá¶á‘á»á€ášá½á… ${STATE.students.length} á“á¶á€áŸ‹!`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT + TEST DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â”€â”€ Try to load saved data first
const hasSaved = loadData();

if(hasSaved){
  // Restore grade pill UI
  document.querySelectorAll('.grade-pill').forEach((el,i)=>{
    el.classList.toggle('active',[7,8,9][i]===STATE.grade);
  });
  // Restore school inputs
  document.getElementById('schoolName').value  = STATE.school;
  document.getElementById('className').value   = STATE.className;
  document.getElementById('schoolYear').value  = STATE.schoolYear;
  document.getElementById('teacherName').value = STATE.teacher;
  if(STATE.school) document.getElementById('tbSub').textContent =
    STATE.school + (STATE.className ? ' Â· ááŸ’á“á¶á€áŸ‹'+STATE.className : '');
  renderStudentList();
  renderSubjectRef();
  updateStudentSelects();
  renderRankings();
  setTimeout(()=>showToast('ğŸ’¾ á‘á·á“áŸ’á“á“áŸá™á”á¶á“á•áŸ’á‘á»á€ Â· Data restored!'), 400);

} else {
  // â”€â”€ No saved data â†’ load demo data
  STATE.school   = 'á¢á“á»áœá·á‘áŸ’á™á¶á›áŸá™á–áŸ’ášáŸ‡áŸáŸŠá¸áŸá»áœááŸ’áá·';
  STATE.className = 'á€';
  STATE.schoolYear = '2024-2025';
  STATE.teacher   = 'á›áŸ„á€á‚áŸ’ášá¼ áŸá»á áœá·áŸá¶á›';
  document.getElementById('schoolName').value  = STATE.school;
  document.getElementById('className').value   = STATE.className;
  document.getElementById('schoolYear').value  = STATE.schoolYear;
  document.getElementById('teacherName').value = STATE.teacher;
  document.getElementById('tbSub').textContent = STATE.school + ' Â· ááŸ’á“á¶á€áŸ‹' + STATE.className;

  function makeScores(vals){
    const obj = {};
    getSubjects(7).forEach(s=>{
      const v = vals[s.id] || [null,null,null,null,null,null,null,null,null,null];
      obj[s.id] = { s1: v.slice(0,5), s2: v.slice(5,10) };
    });
    return obj;
  }

  const testStudents = [
    { name:'á…á¶á“áŸ‹ áŠá¶ášáŸ‰á¶', scores:makeScores({km:[46,44,45,42,46,44,44,46,45,44],ma:[48,46,47,48,46,45,46,44,48,46],en:[42,44,41,45,44,42,43,44,46,42],ph:[39,41,40,42,40,40,42,38,41,40],bi:[44,42,45,44,43,42,44,45,42,44],hi:[40,39,41,40,42,38,40,40,40,41],ge:[38,39,40,38,40,38,40,39,38,40],mo:[45,44,46,44,46,44,45,44,46,44],it:[48,46,45,47,46,46,46,48,46,47]}) },
    { name:'áŸá»á áŸáŸ’ášá¸á“á·á…', scores:makeScores({km:[38,36,39,35,37,36,38,37,36,38],ma:[30,32,31,34,32,32,34,30,32,33],en:[40,41,40,42,40,39,42,40,41,40],ph:[28,29,30,28,28,27,30,28,30,29],bi:[35,34,36,34,36,34,36,35,34,36],hi:[32,34,33,35,34,32,34,33,34,34],ge:[36,35,37,36,36,34,36,36,36,37],mo:[41,40,42,40,42,40,41,40,40,42],it:[39,38,40,38,40,38,40,38,39,40]}) },
    { name:'á áŸá„ áœááŸ’áá¶',   scores:makeScores({km:[28,26,29,25,27,26,28,27,26,28],ma:[22,24,22,25,23,22,24,22,24,23],en:[30,29,31,28,30,28,30,30,30,31],ph:[20,22,21,23,20,20,22,20,22,21],bi:[25,24,26,24,26,24,26,25,24,26],hi:[28,26,28,27,28,26,28,27,28,28],ge:[24,25,26,24,26,24,25,24,26,26],mo:[32,32,34,32,33,31,33,32,32,34],it:[28,26,28,27,28,26,28,27,28,28]}) },
    { name:'á›á¸ á˜á»á“á¸ášáŸááŸ’á“',scores:makeScores({km:[49,48,48,48,50,48,49,48,48,50],ma:[50,49,48,50,50,49,50,50,48,49],en:[48,46,48,47,48,46,48,47,48,48],ph:[46,45,47,46,46,44,46,46,46,45],bi:[48,47,48,48,49,46,48,48,47,48],hi:[45,44,46,44,46,44,46,44,45,46],ge:[44,43,45,44,44,42,44,44,44,45],mo:[48,48,49,48,50,47,48,48,48,49],it:[50,48,49,50,50,48,49,48,50,50]}) },
    { name:'á‘áŸá– á…áŸá“áŸ’á‘á”á¼',  scores:makeScores({km:[21,20,22,19,22,20,22,20,20,21],ma:[18,19,18,20,18,17,19,18,20,18],en:[25,24,26,24,26,24,26,24,25,26],ph:[19,18,20,18,20,18,20,18,19,20],bi:[22,22,24,22,23,21,23,22,22,24],hi:[24,23,25,24,24,22,24,24,23,25],ge:[20,21,22,20,22,20,22,20,21,22],mo:[28,26,28,27,28,26,28,27,26,28],it:[22,22,24,22,23,21,23,22,22,24]}) },
    { name:'áƒá¸á˜ áŸáŸ’ášá¸á–áŸá‡áŸ’áš',scores:makeScores({km:[41,40,42,40,42,40,42,40,40,42],ma:[44,43,45,44,44,42,44,44,43,45],en:[38,37,39,38,38,36,38,38,37,39],ph:[35,34,36,34,36,34,36,34,34,36],bi:[39,38,40,38,40,38,40,38,38,40],hi:[36,35,37,36,36,34,36,36,35,37],ge:[34,33,35,34,34,32,34,34,33,35],mo:[42,42,44,42,43,41,43,42,42,44],it:[40,39,41,40,40,38,40,40,39,41]}) },
    { name:'á”áŸ‰áŸ‚á“ áŸáŸ’ášá¸á›á€áŸ’áááŸ',scores:makeScores({km:[32,32,34,32,33,31,33,32,32,34],ma:[35,34,36,34,36,34,36,34,34,36],en:[34,33,35,34,34,32,34,34,33,35],ph:[30,29,31,30,30,28,30,30,29,31],bi:[32,30,32,31,32,30,32,31,30,32],hi:[29,30,31,30,30,28,30,30,30,31],ge:[28,28,30,28,29,27,29,28,28,30],mo:[36,35,37,36,36,34,36,36,35,37],it:[34,33,35,34,34,32,34,34,33,35]}) },
    { name:'áá»á” á…áŸá“áŸ’á‘áŸá»áá¶', scores:makeScores({km:[25,24,26,24,26,24,26,24,24,26],ma:[26,25,27,26,26,24,26,26,25,27],en:[28,26,28,27,28,26,28,27,26,28],ph:[24,23,25,24,24,22,24,24,23,25],bi:[26,24,26,25,26,24,26,25,24,26],hi:[27,26,28,26,28,26,28,26,26,28],ge:[24,26,26,25,26,24,26,25,26,26],mo:[30,29,31,30,30,28,30,30,29,31],it:[26,26,28,26,27,25,27,26,26,28]}) },
  ];

  testStudents.forEach((td,i)=>{
    STATE.students.push({ id:'st_demo_'+i, name:td.name, scores:td.scores });
  });

  saveData(); // persist demo data immediately
  renderStudentList();
  renderSubjectRef();
  updateStudentSelects();
  renderRankings();
  setTimeout(()=>showToast('âœ… á‘á·á“áŸ’á“á“áŸá™áŸá¶á€á›áŸ’á”á„á”á¶á“á”á‰áŸ’á…á¼á› Â· Demo data loaded!'), 500);
}

// Set nav indicator initial position
document.getElementById('navInd').style.width = '25%';
document.getElementById('navInd').style.left = '0%';
</script>

<script>
/* â”€â”€ SERVICE WORKER REGISTRATION â”€â”€ */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    // Inline SW as blob since we're a single file
    const swCode = `
const CACHE = 'bacii-v2';
const ASSETS = ['./'];
self.addEventListener('install', e => {
  e.waitUntil(caches.open(CACHE).then(c => c.addAll(ASSETS).catch(()=>{})));
  self.skipWaiting();
});
self.addEventListener('activate', e => {
  e.waitUntil(caches.keys().then(keys =>
    Promise.all(keys.filter(k=>k!==CACHE).map(k=>caches.delete(k)))
  ));
  self.clients.claim();
});
self.addEventListener('fetch', e => {
  e.respondWith(
    caches.match(e.request).then(cached => {
      if(cached) return cached;
      return fetch(e.request).then(res => {
        if(!res||res.status!==200||res.type==='opaque') return res;
        const cl = res.clone();
        caches.open(CACHE).then(c=>c.put(e.request,cl));
        return res;
      }).catch(()=>cached||new Response('Offline'));
    })
  );
});`;
    const blob = new Blob([swCode], {type: 'text/javascript'});
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl)
      .then(r => console.log('SW registered', r.scope))
      .catch(e => console.log('SW failed:', e));
  });
}

/* â”€â”€ iOS INSTALL PROMPT â”€â”€ */
(function(){
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  const isStandalone = window.navigator.standalone;
  const dismissed = localStorage.getItem('install_dismissed');
  
  if(isIOS && !isStandalone && !dismissed){
    setTimeout(()=>{
      const banner = document.createElement('div');
      banner.id = 'ios-banner';
      banner.innerHTML = `
        <div style="
          position:fixed;bottom:70px;left:12px;right:12px;
          background:#0e2044;color:#fff;
          border-radius:16px;padding:14px 16px;
          display:flex;align-items:center;gap:12px;
          box-shadow:0 8px 32px rgba(0,0,0,0.4);
          z-index:9999;border:1.5px solid #c9922b;
          animation:slideUp2 0.4s cubic-bezier(0.34,1.56,0.64,1);
        ">
          <div style="font-size:28px;flex-shrink:0;">ğŸ“²</div>
          <div style="flex:1;font-size:12px;font-family:'Noto Sans Khmer',sans-serif;line-height:1.5;">
            <strong style="color:#e8b84b;">á”á‰áŸ’á…á¼á›á€áŸ’á“á»á„ iPhone</strong><br>
            á…á»á… <strong style="color:#e8b84b;">Share</strong> 
            <svg style="width:14px;height:14px;vertical-align:middle;fill:#e8b84b;" viewBox="0 0 24 24"><path d="M12 2l-3 3h2v8h2V5h2L12 2zM4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8h-2v8H6v-8H4z"/></svg>
            ášá½á…á‡áŸ’ášá¾áŸ <strong style="color:#e8b84b;">"Add to Home Screen"</strong>
          </div>
          <button onclick="document.getElementById('ios-banner').remove();localStorage.setItem('install_dismissed','1')"
            style="background:rgba(255,255,255,0.1);border:none;color:rgba(255,255,255,0.6);
            width:24px;height:24px;border-radius:50%;cursor:pointer;font-size:14px;flex-shrink:0;
            display:flex;align-items:center;justify-content:center;">âœ•</button>
        </div>
        <style>@keyframes slideUp2{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}</style>`;
      document.body.appendChild(banner);
    }, 2000);
  }
})();
</script>
</body>
</html>
